[gd_scene load_steps=16 format=3 uid="uid://cfa6joyhm2ntb"]

[ext_resource type="Script" path="res://2d/actors/enemies/enemy_1.gd" id="1_twkv7"]
[ext_resource type="Texture2D" uid="uid://bbve78u03ju8s" path="res://assets/circle.png" id="2_4h0kb"]
[ext_resource type="PackedScene" uid="uid://d03h3h0vkxquc" path="res://2d/components/context_map.tscn" id="3_adc4b"]
[ext_resource type="PackedScene" uid="uid://cgfrp56dfyyer" path="res://2d/components/hitbox.tscn" id="4_50hs0"]
[ext_resource type="Script" path="res://addons/godot_state_charts/state_chart.gd" id="5_v7b2l"]
[ext_resource type="Script" path="res://addons/godot_state_charts/compound_state.gd" id="6_6clgd"]
[ext_resource type="Script" path="res://addons/godot_state_charts/atomic_state.gd" id="7_p2gwc"]
[ext_resource type="Script" path="res://addons/godot_state_charts/transition.gd" id="8_t23rb"]
[ext_resource type="PackedScene" uid="uid://bcwkugn6v3oy7" path="res://addons/godot_state_charts/utilities/state_chart_debugger.tscn" id="9_cw2tx"]

[sub_resource type="CapsuleShape2D" id="CapsuleShape2D_x721j"]
radius = 1.0
height = 4.0

[sub_resource type="CircleShape2D" id="CircleShape2D_hfwcs"]
radius = 120.0

[sub_resource type="CapsuleShape2D" id="CapsuleShape2D_i3dht"]
radius = 6.0
height = 15.0

[sub_resource type="Animation" id="Animation_0be5a"]
resource_name = "Attack"
length = 0.3
tracks/0/type = "method"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Hitbox")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0.1),
"transitions": PackedFloat32Array(1),
"values": [{
"args": [],
"method": &"trigger"
}]
}

[sub_resource type="Animation" id="Animation_l6uwh"]
length = 0.001

[sub_resource type="AnimationLibrary" id="AnimationLibrary_5yqsr"]
_data = {
"Attack": SubResource("Animation_0be5a"),
"RESET": SubResource("Animation_l6uwh")
}

[node name="Enemy1" type="CharacterBody2D"]
collision_layer = 4
script = ExtResource("1_twkv7")
sight_area = Object(Area2D,"_import_path":NodePath(""),"unique_name_in_owner":false,"process_mode":0,"process_priority":0,"process_physics_priority":0,"process_thread_group":0,"editor_description":"","visible":false,"modulate":Color(1, 1, 1, 1),"self_modulate":Color(1, 1, 1, 1),"show_behind_parent":false,"top_level":false,"light_mask":1,"visibility_layer":1,"z_index":0,"z_as_relative":true,"y_sort_enabled":false,"texture_filter":0,"texture_repeat":0,"material":null,"use_parent_material":false,"position":Vector2(0, -3),"rotation":0.0,"scale":Vector2(1, 1),"skew":0.0,"disable_mode":0,"collision_layer":0,"collision_mask":2,"collision_priority":1.0,"input_pickable":true,"monitoring":true,"monitorable":true,"priority":0,"gravity_space_override":0,"gravity_point":false,"gravity_point_unit_distance":0.0,"gravity_point_center":Vector2(0, 1),"gravity_direction":Vector2(0, 1),"gravity":980.0,"linear_damp_space_override":0,"linear_damp":0.1,"angular_damp_space_override":0,"angular_damp":1.0,"audio_bus_override":false,"audio_bus_name":&"Master","script":null)

sight_line = Object(RayCast2D,"_import_path":NodePath(""),"unique_name_in_owner":false,"process_mode":0,"process_priority":0,"process_physics_priority":0,"process_thread_group":0,"editor_description":"","visible":false,"modulate":Color(1, 1, 1, 1),"self_modulate":Color(1, 1, 1, 1),"show_behind_parent":false,"top_level":false,"light_mask":1,"visibility_layer":1,"z_index":0,"z_as_relative":true,"y_sort_enabled":false,"texture_filter":0,"texture_repeat":0,"material":null,"use_parent_material":false,"position":Vector2(0, -3),"rotation":0.0,"scale":Vector2(1, 1),"skew":0.0,"enabled":true,"exclude_parent":true,"target_position":Vector2(0, 50),"collision_mask":1,"hit_from_inside":false,"collide_with_areas":false,"collide_with_bodies":true,"script":null)

nav_agent = Object(NavigationAgent2D,"_import_path":NodePath(""),"unique_name_in_owner":false,"process_mode":0,"process_priority":0,"process_physics_priority":0,"process_thread_group":0,"editor_description":"","target_position":Vector2(0, 0),"path_desired_distance":15.0,"target_desired_distance":10.0,"path_max_distance":100.0,"navigation_layers":1,"pathfinding_algorithm":0,"path_postprocessing":0,"path_metadata_flags":7,"avoidance_enabled":true,"velocity":Vector2(0, 0),"radius":6.0,"neighbor_distance":500.0,"max_neighbors":10,"time_horizon_agents":1.0,"time_horizon_obstacles":0.0,"max_speed":100.0,"avoidance_layers":1,"avoidance_mask":1,"avoidance_priority":1.0,"debug_enabled":false,"debug_use_custom":true,"debug_path_custom_color":Color(0.168627, 0.607843, 0.411765, 0.686275),"debug_path_custom_point_size":1.0,"debug_path_custom_line_width":-1.0,"script":null)

context_map = Object(Node2D,"_import_path":NodePath(""),"unique_name_in_owner":false,"process_mode":0,"process_priority":0,"process_physics_priority":0,"process_thread_group":0,"editor_description":"","visible":true,"modulate":Color(1, 1, 1, 1),"self_modulate":Color(1, 1, 1, 1),"show_behind_parent":false,"top_level":false,"clip_children":0,"light_mask":1,"visibility_layer":1,"z_index":0,"z_as_relative":true,"y_sort_enabled":false,"texture_filter":0,"texture_repeat":0,"material":null,"use_parent_material":false,"position":Vector2(0, 0),"rotation":0.0,"scale":Vector2(1, 1),"skew":0.0,"script":Resource("res://2d/components/context_map.gd"),"vector_count":12,"ray_length":20.0,"ray_collision_mask":1)

hitbox = Object(Area2D,"_import_path":NodePath(""),"unique_name_in_owner":false,"process_mode":0,"process_priority":0,"process_physics_priority":0,"process_thread_group":0,"editor_description":"","visible":true,"modulate":Color(1, 1, 1, 1),"self_modulate":Color(1, 1, 1, 1),"show_behind_parent":false,"top_level":false,"light_mask":1,"visibility_layer":1,"z_index":0,"z_as_relative":true,"y_sort_enabled":false,"texture_filter":0,"texture_repeat":0,"material":null,"use_parent_material":false,"position":Vector2(0, -3),"rotation":0.0,"scale":Vector2(1, 1),"skew":0.0,"disable_mode":0,"collision_layer":0,"collision_mask":2,"collision_priority":1.0,"input_pickable":true,"monitoring":true,"monitorable":true,"priority":0,"gravity_space_override":0,"gravity_point":false,"gravity_point_unit_distance":0.0,"gravity_point_center":Vector2(0, 1),"gravity_direction":Vector2(0, 1),"gravity":980.0,"linear_damp_space_override":0,"linear_damp":0.1,"angular_damp_space_override":0,"angular_damp":1.0,"audio_bus_override":false,"audio_bus_name":&"Master","script":Resource("res://2d/components/hitbox.gd"),"damage":1.0)

cooldown_timer = Object(Timer,"_import_path":NodePath(""),"unique_name_in_owner":false,"process_mode":0,"process_priority":0,"process_physics_priority":0,"process_thread_group":0,"editor_description":"","process_callback":1,"wait_time":0.3,"one_shot":true,"autostart":false,"script":null)

anim_player = Object(AnimationPlayer,"_import_path":NodePath(""),"unique_name_in_owner":false,"process_mode":0,"process_priority":0,"process_physics_priority":0,"process_thread_group":0,"editor_description":"","active":true,"deterministic":false,"reset_on_save":true,"root_node":NodePath(".."),"root_motion_track":NodePath(""),"audio_max_polyphony":32,"callback_mode_process":1,"callback_mode_method":0,"libraries":{
"": SubResource("AnimationLibrary_5yqsr")
},"autoplay":"","playback_default_blend_time":0.0,"speed_scale":1.0,"movie_quit_on_finish":false,"blend_times":[],"script":null)

state_chart = Object(Node,"_import_path":NodePath(""),"unique_name_in_owner":false,"process_mode":0,"process_priority":0,"process_physics_priority":0,"process_thread_group":0,"editor_description":"","script":ExtResource("5_v7b2l"),"track_in_editor":false,"initial_expression_properties":{},"_state":null,"_expression_properties":{},"_queued_events":Array[StringName]([]),"_property_change_pending":false,"_locked_down":false,"_queued_transitions":Array[Dictionary]([]),"_transitions_processing_active":false,"_debugger_remote":null)


[node name="Sprite2D" type="Sprite2D" parent="."]
position = Vector2(0, -3)
scale = Vector2(0.005, 0.005)
texture = ExtResource("2_4h0kb")

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
rotation = -1.5708
shape = SubResource("CapsuleShape2D_x721j")
debug_color = Color(0, 0.6, 0.7, 0.42)

[node name="SightArea" type="Area2D" parent="."]
visible = false
position = Vector2(0, -3)
collision_layer = 0
collision_mask = 2

[node name="CollisionShape2D" type="CollisionShape2D" parent="SightArea"]
shape = SubResource("CircleShape2D_hfwcs")
debug_color = Color(0, 0.6, 0.7, 0.42)

[node name="SightLine" type="RayCast2D" parent="."]
visible = false
position = Vector2(0, -3)

[node name="NavigationAgent2D" type="NavigationAgent2D" parent="."]
path_desired_distance = 15.0
avoidance_enabled = true
radius = 6.0
debug_use_custom = true
debug_path_custom_color = Color(0.168627, 0.607843, 0.411765, 0.686275)
debug_path_custom_point_size = 1.0

[node name="ContextMap" parent="." instance=ExtResource("3_adc4b")]

[node name="Hitbox" parent="." instance=ExtResource("4_50hs0")]
position = Vector2(0, -3)
collision_mask = 2

[node name="Sprite2D" type="Sprite2D" parent="Hitbox"]
modulate = Color(0, 0, 0, 1)
position = Vector2(2, 0)
scale = Vector2(0.001, 0.001)
texture = ExtResource("2_4h0kb")

[node name="CollisionShape2D" type="CollisionShape2D" parent="Hitbox"]
position = Vector2(6, 0)
shape = SubResource("CapsuleShape2D_i3dht")

[node name="CooldownTimer" type="Timer" parent="."]
wait_time = 0.3
one_shot = true

[node name="AnimationPlayer" type="AnimationPlayer" parent="."]
libraries = {
"": SubResource("AnimationLibrary_5yqsr")
}

[node name="StateChart" type="Node" parent="."]
script = ExtResource("5_v7b2l")

[node name="Root" type="Node" parent="StateChart"]
script = ExtResource("6_6clgd")
initial_state = NodePath("Idling")

[node name="Idling" type="Node" parent="StateChart/Root"]
script = ExtResource("7_p2gwc")

[node name="OnTargetSpotted" type="Node" parent="StateChart/Root/Idling"]
script = ExtResource("8_t23rb")
to = NodePath("../../Chasing")
event = &"target_spotted"
delay_in_seconds = "0.0"

[node name="OnAttack" type="Node" parent="StateChart/Root/Idling"]
script = ExtResource("8_t23rb")
to = NodePath("../../Attacking")
event = &"attack"
delay_in_seconds = "0.0"

[node name="Chasing" type="Node" parent="StateChart/Root"]
script = ExtResource("7_p2gwc")

[node name="OnTargetLost" type="Node" parent="StateChart/Root/Chasing"]
script = ExtResource("8_t23rb")
to = NodePath("../../Idling")
event = &"target_lost"
delay_in_seconds = "0.0"

[node name="OnAttack" type="Node" parent="StateChart/Root/Chasing"]
script = ExtResource("8_t23rb")
to = NodePath("../../Attacking")
event = &"attack"
delay_in_seconds = "0.0"

[node name="Attacking" type="Node" parent="StateChart/Root"]
script = ExtResource("7_p2gwc")

[node name="OnAttackFinished" type="Node" parent="StateChart/Root/Attacking"]
script = ExtResource("8_t23rb")
to = NodePath("../../Idling")
event = &"attack_finished"
delay_in_seconds = "0.0"

[node name="CanvasLayer" type="CanvasLayer" parent="."]
visible = false

[node name="StateChartDebugger" parent="CanvasLayer" instance=ExtResource("9_cw2tx")]
anchors_preset = 0
anchor_right = 0.0
anchor_bottom = 0.0
offset_top = 105.0
offset_right = 363.0
offset_bottom = 352.0
grow_horizontal = 1
grow_vertical = 1
scale = Vector2(0.3, 0.3)
initial_node_to_watch = NodePath("../..")
ignore_events = true
ignore_transitions = true

[connection signal="velocity_computed" from="NavigationAgent2D" to="." method="_on_nav_agent_velocity_computed"]
[connection signal="state_entered" from="StateChart/Root/Idling" to="." method="_on_idling_state_entered"]
[connection signal="state_physics_processing" from="StateChart/Root/Idling" to="." method="_on_idling_state_physics_processing"]
[connection signal="state_exited" from="StateChart/Root/Chasing" to="." method="_on_chasing_state_exited"]
[connection signal="state_physics_processing" from="StateChart/Root/Chasing" to="." method="_on_chasing_state_physics_processing"]
[connection signal="state_entered" from="StateChart/Root/Attacking" to="." method="_on_attacking_state_entered"]
